<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mnu.myblog.mapper.AdminLogMapper">

    <!-- ================= ë¡œê·¸ ì €ìž¥ ================= -->
    <insert id="insertAdminLog"
            parameterType="com.mnu.myblog.domain.AdminLogDTO">
        INSERT INTO admin_log (
            admin_id,
            action,
            target,
            created_at
        ) VALUES (
            #{adminId},
            #{action},
            #{target},
            NOW()
        )
    </insert>

    <!-- ================= ì „ì²´ ë¡œê·¸ ì¡°íšŒ ================= -->
    <select id="findAllLogs"
            resultType="com.mnu.myblog.domain.AdminLogDTO">
        SELECT
            id,
            admin_id   AS adminId,
            action,
            target,
            created_at AS createdAt
        FROM admin_log
        ORDER BY created_at DESC
    </select>

    <!-- ================= ðŸ”¥ 6ì‹œê°„ ì§€ë‚œ ë¡œê·¸ ìžë™ ì‚­ì œ ================= -->
    <delete id="deleteLogsOlderThan6Hours">
        <![CDATA[
            DELETE
            FROM admin_log
            WHERE created_at < NOW() - INTERVAL 6 HOUR
        ]]>
    </delete>

    <!-- ================= ðŸ”¥ ì „ì²´ ë¡œê·¸ ì‚­ì œ ================= -->
    <delete id="deleteAllLogs">
        DELETE FROM admin_log
    </delete>

    <!-- ================= ðŸ”¥ ë‹¨ì¼ ë¡œê·¸ ì‚­ì œ ================= -->
    <delete id="deleteLogById">
        DELETE
        FROM admin_log
        WHERE id = #{logId}
    </delete>

</mapper>