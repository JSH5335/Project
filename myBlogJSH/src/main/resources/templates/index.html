<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">

<title>Jo's Developer Blog</title>

<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/index.css">
<link rel="stylesheet" href="/css/withdraw.css">

<style>
/* ================= íšŒì› íƒˆí‡´ íŒì—… ================= */
.withdraw-modal {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.55);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.withdraw-modal.active {
    display: flex;
}

.withdraw-box {
    background: var(--bg-card);
    width: 380px;
    padding: 32px;
    border-radius: 22px;
    box-shadow: 0 30px 80px rgba(0,0,0,0.3);
    text-align: center;
}

.withdraw-box h2 {
    font-size: 22px;
    margin-bottom: 10px;
}

.withdraw-box p {
    font-size: 14px;
    color: var(--text-sub);
    line-height: 1.6;
    margin-bottom: 22px;
}

.withdraw-box input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    margin-bottom: 18px;
}

.withdraw-confirm-btn {
    width: 100%;
    padding: 13px;
    border-radius: 14px;
    border: none;
    background: #7f1d1d;
    color: #fff;
    font-weight: 700;
    cursor: pointer;
}

.withdraw-cancel {
    margin-top: 16px;
    font-size: 14px;
    color: #6366f1;
    cursor: pointer;
}

/* ================= ìƒíƒœ ë©”ì‹œì§€ ================= */
.profile-message-form {
    margin-top: 6px;
}

.profile-message-input {
    width: 100%;
    border: none;
    background: transparent;
    font-size: 14px;
    color: var(--text-light);
    outline: none;
    padding: 4px 0;
}

.profile-message-input::placeholder {
    color: #94a3b8;
}

.profile-message-input:focus {
    border-bottom: 1px dashed #c7d2fe;
}
</style>
</head>

<body th:classappend="${session.darkMode == true} ? ' dark' : ''">

<div class="layout">

    <!-- ===== ã‚µã‚¤ãƒ‰ãƒãƒ¼ ===== -->
    <aside class="sidebar">

        <!-- ================= ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ ================= -->
        <div th:if="${session.loginUser != null}" class="profile-card">

            <div class="profile-wrapper">
                <form action="/profile/upload"
                      method="post"
                      enctype="multipart/form-data">

                    <input type="file"
                           id="profileInput"
                           name="profileImage"
                           accept="image/*"
                           style="display:none;"
                           onchange="this.form.submit();">

                    <label for="profileInput">

                        <!-- âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ìˆì„ ë•Œ -->
                        <img th:if="${session.loginUser.profileImage != null}"
                             th:src="${session.loginUser.profileImage}"
                             class="profile-img"
                             alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ">

                        <!-- âœ… ê¸°ë³¸ ì´ë¯¸ì§€ -->
                        <img th:if="${session.loginUser.profileImage == null}"
                             src="/images/default-profile.png"
                             class="profile-img"
                             alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ">

                        <div class="profile-overlay">ğŸ“·</div>
                    </label>
                </form>
            </div>

            <div class="profile-info">
                <div class="name"
                     th:text="${session.loginUser.userName}"></div>

                <div class="role"
                     th:classappend="${session.loginUser.role == 'ADMIN'} ? ' admin' : ' member'">
                    <span th:if="${session.loginUser.role == 'ADMIN'}">ğŸ‘‘ ç®¡ç†è€…</span>
                    <span th:if="${session.loginUser.role != 'ADMIN'}">ğŸ‘¤ ä¼šå“¡</span>
                </div>

                <!-- âœ… ìƒíƒœ ë©”ì‹œì§€ (ì—”í„° ì €ì¥) -->
                <form action="/user/profile-message"
                      method="post"
                      class="profile-message-form">
                    <input type="text"
                           name="profileMessage"
                           class="profile-message-input"
                           th:value="${session.loginUser.profileMessage}"
                           placeholder="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                           onkeydown="return submitProfileMessage(event)">
                </form>
            </div>

            <!-- ë¡œê·¸ì•„ì›ƒ -->
            <a href="/logout" class="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>

            <!-- âœ… íšŒì› íƒˆí‡´ (íŒì—… í˜¸ì¶œ) -->
            <button th:if="${session.loginUser.role != 'ADMIN'}"
                    type="button"
                    class="logout-btn"
                    style="margin-top:12px; background:#7f1d1d;"
                    onclick="openWithdrawModal()">
                ä¼šå“¡é€€ä¼š
            </button>

            <!-- ê´€ë¦¬ì ì¹´ë“œ -->
            <div th:if="${session.loginUser.role == 'ADMIN'}"
                 class="admin-card">
                <div class="admin-card-title">ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
                <a href="/admin" class="admin-card-link">
                    ğŸ›  ç®¡ç†è€…ãƒšãƒ¼ã‚¸
                </a>
            </div>

            <!-- ğŸŒ™ ãƒ€ãƒ¼ã‚¯ëª¨ë“œ -->
            <form th:action="@{/darkmode/toggle}" method="post">
                <button type="submit" class="darkmode-btn">
                    <span th:if="${session.darkMode == true}">â˜€ï¸ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</span>
                    <span th:if="${session.darkMode != true}">ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</span>
                </button>
            </form>

        </div>

        <!-- ================= éãƒ­ã‚°ã‚¤ãƒ³ ================= -->
        <div th:if="${session.loginUser == null}" class="brand-home">

            <div class="logo-wrapper">
                <img src="/images/logo.png"
                     alt="Jo's Developer Blog Logo"
                     class="logo-img">
            </div>

            <div class="hero-text">
                <h1 class="hero-title">Jo's Developer Blog</h1>
                <p class="hero-role">
                    Javaãƒ»Spring Bootãƒ»Webãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼
                </p>
                <p class="hero-desc">
                    ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹ã®æ§‹é€ ã¨æµã‚Œã‚’ç†è§£ã—ã€<br>
                    ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’è€ƒæ…®ã—ãŸé–‹ç™ºã‚’ç›®æŒ‡ã—ã¾ã™ã€‚
                </p>
            </div>

            <div class="login-box">
                <form method="post" action="/login">
                    <input type="text" name="userId" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ID">
                    <input type="password" name="userPw" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                    <button type="submit" class="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
                </form>
            </div>

        </div>

    </aside>

    <!-- ===== ãƒ¡ã‚¤ãƒ³ ===== -->
    <section class="main">

        <div class="header">
            <div class="dashboard-hero">
                <h1>
                    ã‚ˆã†ã“ã <span>Jo's Developer Blog</span> ã¸
                </h1>
                <p>
                    Javaãƒ»Spring Bootã‚’åŸºç›¤ã¨ã—ã¦ã€<br>
                    ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹ã‚’è¨­è¨ˆãƒ»å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
                </p>
            </div>

            <nav class="top-menu">
                <a href="/notice/list">ãŠçŸ¥ã‚‰ã›</a>
                <a href="/archive">ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</a>

                <a href="/register"
                   class="signup"
                   th:if="${session.loginUser == null}">
                   ä¼šå“¡ç™»éŒ²
                </a>
            </nav>
        </div>

        <div class="cards">

            <div class="card notice-card">
                <h2>ğŸ“¢ ãŠçŸ¥ã‚‰ã›</h2>

                <ul class="notice-list">
                    <li th:each="notice : ${noticeList}" class="notice-item">

                        <div class="notice-thumb"
                             th:if="${notice.imagePath != null and notice.imagePath != ''}">
                            <img th:src="@{${notice.imagePath}}">
                        </div>

                        <div class="notice-text">
                            <div class="notice-title"
                                 th:text="${notice.title}"></div>
                            <div class="notice-date"
                                 th:text="${#temporals.format(notice.createdAt,'yyyy.MM.dd')}"></div>
                        </div>

                    </li>
                </ul>

                <a href="/notice/list" class="more-link">
                    ãŠçŸ¥ã‚‰ã›ã‚’ã‚‚ã£ã¨è¦‹ã‚‹ â†’
                </a>
            </div>

            <div class="card portfolio-card">
                <h2>ğŸ—‚ ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h2>
                <ul class="list portfolio-list">
                    <li th:each="post : ${popularPostList}">
                        <a th:href="@{/post/view/{postId}(postId=${post.postId})}"
                              th:text="${post.title}"></a>
                    </li>
                </ul>
            </div>

        </div>

        <footer>
            Â© 2026 Jo's Developer Blog. å…¨è‘—ä½œæ¨©æ‰€æœ‰
        </footer>

    </section>

</div>

<!-- ================= íšŒì› íƒˆí‡´ íŒì—… ================= -->
<div class="withdraw-modal" id="withdrawModal">
    <div class="withdraw-box">
        <h2>âš  ä¼šå“¡é€€ä¼š</h2>
        <p id="withdrawMessage">
            é€€ä¼šã™ã‚‹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç¢ºèªãŒå¿…è¦ã§ã™ã€‚<br>
            ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚
        </p>

        <form method="post" action="/user/withdraw" onsubmit="return handleWithdrawSubmit()">
            <input type="password"
                   name="userPw"
                   placeholder="ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                   required>

            <button type="submit" id="withdrawConfirmBtn" class="withdraw-confirm-btn">
                é€€ä¼šã™ã‚‹
            </button>
        </form>

        <div class="withdraw-cancel"
             onclick="closeWithdrawModal()">
            â† ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </div>
    </div>
</div>

<!-- ğŸ Toast -->
<div id="toast"
     th:if="${session.toastMsg}"
     th:text="${session.toastMsg}"
     th:class="'toast ' + ${session.toastType}">
</div>

<script>
function openWithdrawModal() {
    resetWithdrawUI();
    document.getElementById('withdrawModal').classList.add('active');
}

function closeWithdrawModal() {
    document.getElementById('withdrawModal').classList.remove('active');
}

let withdrawConfirmed = false;

function handleWithdrawSubmit() {
    const btn = document.getElementById('withdrawConfirmBtn');
    const msg = document.getElementById('withdrawMessage');

    if (!withdrawConfirmed) {
        withdrawConfirmed = true;
        btn.textContent = 'æœ¬å½“ã«é€€ä¼šã—ã¾ã™ã‹ï¼Ÿ';
        btn.style.background = '#991b1b';
        msg.innerHTML = 'æœ€çµ‚ç¢ºèªã§ã™ã€‚<br>æœ¬å½“ã«é€€ä¼šã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ';
        return false;
    }
    return true;
}

function resetWithdrawUI() {
    withdrawConfirmed = false;
    const btn = document.getElementById('withdrawConfirmBtn');
    const msg = document.getElementById('withdrawMessage');

    btn.textContent = 'é€€ä¼šã™ã‚‹';
    btn.style.background = '#7f1d1d';
    msg.innerHTML =
        'é€€ä¼šã™ã‚‹ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ç¢ºèªãŒå¿…è¦ã§ã™ã€‚<br>ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚';
}

/* âœ… ìƒíƒœ ë©”ì‹œì§€ ì—”í„° ì €ì¥ */
function submitProfileMessage(e) {
    if (e.key === 'Enter') {
        e.preventDefault();

        const input = e.target;
        input.classList.add('saved');

        setTimeout(() => {
            input.classList.remove('saved');
        }, 900);

        input.form.submit();
        return false;
    }
    return true;
}
</script>

</body>
</html>