<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>è¨˜äº‹ç·¨é›† | Jo's Blog</title>

<link rel="stylesheet" href="/css/main.css">
<link rel="stylesheet" href="/css/post_write.css">

<style>
/* ================== ì¹´ë“œ ë ˆì´ì•„ì›ƒ ================== */
.write-container {
    max-width: 900px; /* â¬…ï¸ ì‚¬ì´ì¦ˆ í™•ëŒ€ */
    margin: 60px auto;
    padding: 0 20px;
}

/* ===== ìˆ˜ì • í™”ë©´ í—¤ë” ===== */
.edit-header {
    margin-bottom: 20px;
}

.edit-header h1 {
    font-size: 24px;
    font-weight: 800;
    color: #111827;
}

.edit-header p {
    font-size: 14px;
    color: #64748b;
    margin-top: 6px;
}

.write-card {
    background: #ffffff;
    padding: 48px 56px; /* â¬…ï¸ ì—¬ë°± í™•ëŒ€ */
    border-radius: 24px;
    box-shadow: 0 24px 60px rgba(15,23,42,0.1);
    display: flex;
    flex-direction: column;
    gap: 28px;
}

/* ================== ì…ë ¥í¼ ================== */
.write-input {
    width: 100%;
    padding: 14px 18px;
    border-radius: 14px;
    border: 1px solid #e5e7eb;
    font-size: 15px;
    color: #111827;
    font-family: 'Noto Sans JP', sans-serif;
}

.write-textarea {
    width: 100%;
    min-height: 260px; /* â¬…ï¸ ë†’ì´ ì¦ê°€ */
    padding: 14px 18px;
    border-radius: 14px;
    border: 1px solid #e5e7eb;
    font-size: 15px;
    color: #111827;
    font-family: 'Noto Sans JP', sans-serif;
    resize: vertical;
}

/* ================== íŒŒì¼ ì—…ë¡œë“œ ================== */
.file-wrapper {
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-family: 'Noto Sans JP', sans-serif;
}

.file-wrapper label {
    font-size: 13px;
    font-weight: 700;
    color: #334155;
    cursor: pointer;
}

#uploadFile {
    display: none;
}

.custom-file-btn {
    display: inline-block;
    padding: 10px 18px;
    border-radius: 14px;
    background-color: #e5e7eb;
    color: #111827;
    font-size: 13px;
    cursor: pointer;
    transition: background 0.2s ease;
    width: fit-content;
}

.custom-file-btn:hover {
    background-color: #d1d5db;
}

#fileName {
    font-size: 13px;
    color: #64748b;
    font-style: italic;
}

.remove-file-btn {
    display: inline-block;
    padding: 6px 14px;
    border-radius: 12px;
    background-color: #f87171;
    color: #ffffff;
    font-size: 12px;
    cursor: pointer;
    margin-top: 6px;
}

.remove-file-btn:hover {
    background-color: #ef4444;
}

/* ================== ë²„íŠ¼ ================== */
.write-buttons {
    display: flex;
    gap: 14px;
    justify-content: flex-end;
    margin-top: 32px;
}

.write-btn {
    padding: 12px 28px;
    border-radius: 14px;
    font-weight: 700;
    cursor: pointer;
    text-decoration: none;
    border: none;
    font-size: 14px;
    transition: background 0.2s ease;
}

.write-btn.cancel {
    background: #e5e7eb;
    color: #111827;
}

.write-btn.cancel:hover {
    background: #d1d5db;
}

.write-btn.submit {
    background: #3b82f6;
    color: #ffffff;
}

.write-btn.submit:hover {
    background: #2563eb;
}
</style>
</head>

<body th:classappend="${session.darkMode} ? ' dark' : ''">

<div class="layout">
    <section class="write-container">

        <!-- âœï¸ ìˆ˜ì • í™”ë©´ ì•ˆë‚´ -->
        <div class="edit-header">
            <h1>âœï¸ è¨˜äº‹ã‚’ä¿®æ­£ã—ã¦ã„ã¾ã™</h1>
            <p>æ—¢å­˜ã®è¨˜äº‹ã®å†…å®¹ã‚’ç·¨é›†ã§ãã¾ã™ã€‚ä¿®æ­£å¾Œã¯ã€Œä¿®æ­£å®Œäº†ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <div class="write-card">
            <form method="post" th:action="@{/post/edit}" enctype="multipart/form-data">

                <input type="hidden" name="postId" th:value="${post.postId}">

                <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
                <input type="text" name="title" class="write-input"
                       th:value="${post.title}"
                       placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                       required>

                <!-- å†…å®¹ -->
                <textarea name="content"
                          class="write-textarea"
                          placeholder="å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                          required
                          th:text="${post.content}"></textarea>

                <!-- ğŸ“ ì²¨ë¶€íŒŒì¼ -->
                <div class="file-wrapper">
                    <label class="custom-file-btn" for="uploadFile">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</label>
                    <input type="file" name="uploadFile" id="uploadFile">

                    <div id="fileName"
                         th:text="${post.originalFileName != null}
                         ? 'é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: ' + ${post.originalFileName}
                         : 'é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“'">
                        é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“
                    </div>

                    <div th:if="${post.originalFileName != null}"
                         class="remove-file-btn"
                         id="removeFileBtn">
                        æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
                    </div>
                </div>

                <!-- ë²„íŠ¼ -->
                <div class="write-buttons">
                    <a th:href="@{/post/view/{postId}(postId=${post.postId})}"
                       class="write-btn cancel">â† ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
                    <button type="submit" class="write-btn submit">ä¿®æ­£å®Œäº†</button>
                </div>

            </form>
        </div>
    </section>
</div>

<script>
const fileInput = document.getElementById('uploadFile');
const fileName = document.getElementById('fileName');
const removeBtn = document.getElementById('removeFileBtn');

fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
        fileName.textContent = 'é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: ' + fileInput.files[0].name;
    } else {
        fileName.textContent = 'é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“';
    }
});

if(removeBtn){
    removeBtn.addEventListener('click', () => {
        let form = fileInput.closest('form');

        let hidden = document.createElement('input');
        hidden.type = 'hidden';
        hidden.name = 'deleteFile';
        hidden.value = 'true';
        form.appendChild(hidden);

        fileName.textContent = 'é¸æŠã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“';
        removeBtn.style.display = 'none';
    });
}
</script>

</body>
</html>