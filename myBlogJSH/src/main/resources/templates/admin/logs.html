<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ç®¡ç†è€…ãƒ­ã‚° | ç®¡ç†è€…</title>

    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="/css/admin_log.css">
</head>

<body th:classappend="${session.darkMode} ? ' dark' : ''">

<div class="layout">

    <div th:replace="admin/fragments/sidebar :: adminSidebar"></div>

    <section class="main">

        <div class="header">
            <div>
                <h1>ğŸ“‹ ç®¡ç†è€…ãƒ­ã‚°</h1>
                <p class="sub-text">ç®¡ç†è€…ã«ã‚ˆã‚‹æ“ä½œå±¥æ­´</p>
            </div>

            <form action="/admin/logs/delete-all" method="post">
                <button type="button"
                        class="notice-btn notice-btn-delete"
                        onclick="openConfirm(this.form, 'ã™ã¹ã¦ã®ãƒ­ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                    ğŸ—‘ å…¨å‰Šé™¤
                </button>
            </form>
        </div>

        <div class="card">
            <table class="admin-table">
                <thead>
                <tr>
                    <th style="width:70px;">No</th>
                    <th style="width:140px;">ç®¡ç†è€…</th>
                    <th style="width:200px;">æ“ä½œå†…å®¹</th>
                    <th>å¯¾è±¡</th>
                    <th style="width:180px;">æ—¥æ™‚</th>
                    <th style="width:90px;">ç®¡ç†</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="log, stat : ${logList}">
                    <td th:text="${stat.count}"></td>

                    <td>
                        <span class="badge-admin"
                              th:text="${log.adminId}"></span>
                    </td>

                    <!-- âœ… actionì€ Stringì´ë¯€ë¡œ switchë¡œ ì²˜ë¦¬ -->
                    <td>
                        <span class="badge-action">
                            <span th:switch="${log.action}">
                                <!-- POST -->
                                <span th:case="'POST_DELETE'">ğŸ—‘ æŠ•ç¨¿å‰Šé™¤</span>
                                <span th:case="'POST_RESTORE'">â™»ï¸ æŠ•ç¨¿å¾©å…ƒ</span>
                                <span th:case="'POST_HIDE'">ğŸ™ˆ æŠ•ç¨¿éè¡¨ç¤º</span>
                                <span th:case="'POST_SHOW'">ğŸ‘ æŠ•ç¨¿è¡¨ç¤º</span>
                                <span th:case="'POST_PIN'">ğŸ“Œ æŠ•ç¨¿å›ºå®š</span>
                                <span th:case="'POST_UNPIN'">ğŸ“ å›ºå®šè§£é™¤</span>

                                <!-- COMMENT -->
                                <span th:case="'COMMENT_DELETE'">ğŸ—‘ ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤</span>
                                <span th:case="'COMMENT_REPORT_SOFT_DELETE'">ğŸš¨ é€šå ±ã‚³ãƒ¡ãƒ³ãƒˆéå…¬é–‹</span>
                                <span th:case="'COMMENT_REPORT_HARD_DELETE'">â›” é€šå ±ã‚³ãƒ¡ãƒ³ãƒˆå®Œå…¨å‰Šé™¤</span>
                                <span th:case="'COMMENT_REPORT_IGNORE'">âœ… é€šå ±ç„¡è¦–</span>

                                <!-- USER -->
                                <span th:case="'USER_ROLE_UPDATE'">ğŸ‘‘ æ¨©é™å¤‰æ›´</span>
                                <span th:case="'USER_BAN'">ğŸš« ä¼šå“¡åœæ­¢</span>
                                <span th:case="'USER_UNBAN'">â™»ï¸ åœæ­¢è§£é™¤</span>

                                <!-- NOTICE -->
                                <span th:case="'NOTICE_CREATE'">ğŸ“ ãŠçŸ¥ã‚‰ã›ä½œæˆ</span>
                                <span th:case="'NOTICE_DELETE'">ğŸ—‘ ãŠçŸ¥ã‚‰ã›å‰Šé™¤</span>
                                <span th:case="'NOTICE_PIN'">ğŸ“Œ ãŠçŸ¥ã‚‰ã›å›ºå®š</span>
                                <span th:case="'NOTICE_UNPIN'">ğŸ“ å›ºå®šè§£é™¤</span>
                                <span th:case="'NOTICE_VISIBLE'">ğŸ‘ è¡¨ç¤ºåˆ‡æ›¿</span>

                                <!-- DEFAULT -->
                                <span th:case="*">ãã®ä»–</span>
                            </span>
                        </span>
                    </td>

                    <td class="log-target"
                        th:text="${log.target}"></td>

                    <td th:text="${#temporals.format(log.createdAt,'yyyy.MM.dd HH:mm')}"></td>

                    <td>
                        <form action="/admin/logs/delete"
                              method="post"
                              class="inline-form">
                            <input type="hidden"
                                   name="logId"
                                   th:value="${log.id}">
                            <button type="button"
                                    class="notice-btn notice-btn-delete"
                                    onclick="openConfirm(this.form, 'ã“ã®ãƒ­ã‚°ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')">
                                å‰Šé™¤
                            </button>
                        </form>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(logList)}">
                    <td colspan="6" class="empty-row">
                        ãƒ­ã‚°ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <footer>
            ç®¡ç†è€…ãƒšãƒ¼ã‚¸ Â· Jo's Developer Blog
        </footer>
    </section>
</div>

<!-- ===== ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« ===== -->
<div id="confirmOverlay" class="confirm-overlay">
    <div class="confirm-box">
        <div class="icon">âš ï¸</div>
        <h3 id="confirmTitle">æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</h3>
        <p>
            ã“ã®æ“ä½œã¯ <b style="color:#ef4444;">å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚</b><br>
            ç®¡ç†è€…ãƒ­ã‚°ã¯å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
        </p>

        <div class="confirm-actions">
            <button type="button"
                    class="notice-btn notice-btn-delete"
                    id="confirmYes">
                å‰Šé™¤
            </button>
            <button type="button"
                    class="notice-btn notice-btn-hide"
                    onclick="closeConfirm()">
                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </button>
        </div>
    </div>
</div>

<div id="toast"
     th:if="${toastMsg}"
     th:text="${toastMsg}"
     th:class="'toast ' + ${toastType}">
</div>

<script>
    let targetForm = null;

    function openConfirm(form, message) {
        targetForm = form;
        document.getElementById('confirmTitle').innerText = message;
        document.getElementById('confirmOverlay').style.display = 'flex';
    }

    function closeConfirm() {
        targetForm = null;
        document.getElementById('confirmOverlay').style.display = 'none';
    }

    document.getElementById('confirmYes').addEventListener('click', function () {
        if (targetForm) {
            targetForm.submit();
            closeConfirm();
        }
    });
</script>

</body>
</html>