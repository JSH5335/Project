<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>お知らせ管理 | 管理者</title>

    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/admin.css">
    <!-- ✅ お知らせ管理専用 -->
    <link rel="stylesheet" href="/css/admin_notice.css">
</head>
<body th:classappend="${session.darkMode} ? ' dark' : ''">

<div class="layout">

    <!-- ===== 管理者サイドバー ===== -->
    <div th:replace="admin/fragments/sidebar :: adminSidebar"></div>

    <!-- ===== メイン ===== -->
    <section class="main">

        <!-- ===== ヘッダー ===== -->
        <div class="header">
            <div>
                <h1>📢 お知らせ管理</h1>
                <p class="sub-text">
                    お知らせの登録、固定（PIN）、表示設定を管理します。
                </p>
            </div>
        </div>

        <!-- 🔍 検索 -->
        <form th:action="@{/admin/notice/list}"
              method="get"
              class="notice-search-box">

            <input type="text"
                   name="keyword"
                   placeholder="お知らせのタイトルまたは内容を検索"
                   th:value="${keyword}">

            <button type="submit">検索</button>
        </form>

        <!-- 📄 お知らせ一覧 -->
        <div class="card">

            <table class="admin-table">
                <thead>
                <tr>
                    <th style="width:80px;">番号</th>
                    <th>お知らせ</th>
                    <th style="width:90px;">表示</th>
                    <th style="width:90px;">PIN</th>
                    <th style="width:220px;">管理</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="notice, iterStat : ${noticeList}">

                    <!-- 番号 -->
                    <td th:text="${iterStat.index + 1}"></td>

                    <!-- お知らせ -->
                    <td class="notice-title-cell">
                        <div class="notice-row">

                            <img th:if="${notice.imagePath != null and notice.imagePath != ''}"
                                 th:src="${notice.imagePath}"
                                 class="notice-thumb-sm">

                            <div class="notice-info">
                                <div class="notice-title-line">
                                    <span th:if="${notice.pinned == 1}">📌</span>
                                    <span class="notice-title-text"
                                          th:text="${notice.title}"></span>
                                </div>
                            </div>

                        </div>
                    </td>

                    <!-- 表示 -->
                    <td th:text="${notice.visible == 1 ? '表示' : '非表示'}"></td>

                    <!-- PIN -->
                    <td th:text="${notice.pinned == 1 ? '固定' : '通常'}"></td>

                    <!-- 管理 🔥 구조만 변경 -->
                    <td class="admin-action-cell">
                        <div class="action-cell-inner">
                            <div class="notice-action-group">

                                <!-- 表示 / 非表示 -->
                                <form th:action="@{/admin/notice/toggle-visible/{id}(id=${notice.noticeId})}"
                                      method="post">
                                    <button type="submit"
                                            class="notice-btn notice-btn-hide">
                                        非表示
                                    </button>
                                </form>

                                <!-- PIN -->
                                <form th:action="@{/admin/notice/toggle-pinned/{id}(id=${notice.noticeId})}"
                                      method="post">
                                    <button type="submit"
                                            class="notice-btn notice-btn-pin"
                                            th:classappend="${notice.pinned == 1} ? ' active' : ''">
                                        PIN
                                    </button>
                                </form>

                                <!-- 削除 -->
                                <form th:action="@{/admin/notice/delete/{id}(id=${notice.noticeId})}"
                                      method="post">
                                    <button type="submit"
                                            class="notice-btn notice-btn-delete">
                                        削除
                                    </button>
                                </form>

                            </div>
                        </div>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(noticeList)}">
                    <td colspan="5" class="empty-row">
                        お知らせがありません。
                    </td>
                </tr>
                </tbody>
            </table>

        </div>

        <!-- ➕ お知らせ作成 -->
        <div class="admin-back">
            <a href="/admin/notice/write">➕ お知らせ作成</a>
        </div>

        <footer>
            管理者ページ · Jo's Developer Blog
        </footer>

    </section>

</div>

</body>
</html>